<page-header class="bg-green-50" />

<div class="quotation-actions">
  <div class="actions-container">
    <div class="search-container">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search Quotations</mat-label>
        <input matInput
               [(ngModel)]="searchText"
               (ngModelChange)="onSearchChange($event)"
               placeholder="Search by ID, customer, user, quotation, amount, or date">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>
    <div class="button-group">
      <button mat-raised-button color="primary" (click)="openAddCustomerDialog()">
        <mat-icon>person_add</mat-icon>
        Add Customer
      </button>
      <button mat-raised-button color="primary" (click)="openAddQuotationDialog()">
        <mat-icon>add</mat-icon>
        Add Quotation
      </button>
    </div>
  </div>
</div>

<mat-card class="customer-card">
  <mat-card-header>
    <mat-card-title>Customers</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <mtx-grid
      [data]="customers"
      [columns]="customerColumns"
      [loading]="customerLoading"
      [showToolbar]="true"
      [pageSize]="5"
      [pageSizeOptions]="[5, 10, 25, 50]">
    </mtx-grid>
  </mat-card-content>
</mat-card>

<mat-card class="quotation-card">
  <mat-card-header>
    <mat-card-title>Quotations</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <mtx-grid
      [data]="filteredQuotations"
      [columns]="columns"
      [loading]="isLoading"
      [showToolbar]="true"
      [pageSize]="5"
      [pageSizeOptions]="[5, 10, 25, 50]">
    </mtx-grid>
  </mat-card-content>
</mat-card>

<!-- Quotation Dialog -->
<ng-template #quotationDialog>
  <h2 mat-dialog-title>{{ isEditMode ? 'Edit' : 'Add' }} Quotation</h2>
  <mat-dialog-content>
    <div class="quotation-form">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Customer</mat-label>
        <mat-select [(ngModel)]="quotationForm.customerId">
          <mat-option *ngFor="let customer of customers" [value]="customer.id">
            {{ customer.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Quotation No</mat-label>
        <input matInput [(ngModel)]="quotationForm.quotationNo" disabled>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Quotation Date</mat-label>
        <input matInput [matDatepicker]="picker" [(ngModel)]="quotationForm.quotationDate">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <div class="quotation-items-section">
        <div class="section-header">
          <h3>Quotation Items</h3>
          <button mat-raised-button color="primary" (click)="openAddItemDialog()">
            <mat-icon>add</mat-icon>
            Add Item
          </button>
        </div>

        <mtx-grid
          [data]="quotationForm.items || []"
          [columns]="itemColumns"
          [loading]="false"
          [showToolbar]="false"
          [pageSize]="5"
          [pageSizeOptions]="[5, 10, 25, 50]">
        </mtx-grid>

        <div class="total-section">
          <h3>Total Amount: ${{ quotationForm.totalAmount.toFixed(2) }}</h3>
        </div>
      </div>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Cancel</button>
    <button mat-raised-button color="primary" [mat-dialog-close]="quotationForm">Save</button>
  </mat-dialog-actions>
</ng-template>

<!-- Customer Dialog -->
<ng-template #customerDialog>
  <h2 mat-dialog-title>{{ isCustomerEditMode ? 'Edit' : 'Add' }} Customer</h2>
  <mat-dialog-content>
    <div class="customer-form">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Name</mat-label>
        <input matInput [(ngModel)]="customerForm.name" required>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Phone</mat-label>
        <input matInput [(ngModel)]="customerForm.phone" required>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email</mat-label>
        <input matInput [(ngModel)]="customerForm.email" type="email" required>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Address</mat-label>
        <textarea matInput [(ngModel)]="customerForm.address" required rows="3"></textarea>
      </mat-form-field>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Cancel</button>
    <button mat-raised-button color="primary" [mat-dialog-close]="customerForm">Save</button>
  </mat-dialog-actions>
</ng-template>
